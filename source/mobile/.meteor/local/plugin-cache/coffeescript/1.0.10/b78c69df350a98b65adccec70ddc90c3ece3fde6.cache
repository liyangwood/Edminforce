{"source":"__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;\nMeteor.methods({\n  recallMessage: function(messageId) {\n    var lapse, message, now;\n    check(messageId, String);\n    message = Chat.Messages.findOne(messageId);\n    if (!message) {\n      throw new Meteor.error(\"message doesn't exist\");\n    }\n    if (!(this.userId && this.userId === message.from)) {\n      throw new Meteor.error(\"user has no right to delete the message\");\n    } else {\n      now = new Date();\n      lapse = now - message.createdAt;\n      if (lapse > 60000) {\n        throw new Meteor.error(\"can't recall a message after 5 minutes\");\n      } else {\n        return Chat.Messages.remove(messageId);\n      }\n    }\n  }\n});\n","sourceMap":{"version":3,"file":"/methods.coffee.js","sourceRoot":"","sources":["/packages/ihealth_chat-engine/methods.coffee"],"names":[],"mappings":";AAEA,MAAM,CAAC,OAAP,CAEE;AAAA,EAAA,aAAA,EAAe,SAAC,SAAD,GAAA;AACb,QAAA,mBAAA;AAAA,IAAA,KAAA,CAAM,SAAN,EAAiB,MAAjB,CAAA,CAAA;AAAA,IAEA,OAAA,GAAU,IAAI,CAAC,QAAQ,CAAC,OAAd,CAAsB,SAAtB,CAFV,CAAA;AAGA,IAAA,IAAA,CAAA,OAAA;AACE,YAAU,IAAA,MAAM,CAAC,KAAP,CAAa,uBAAb,CAAV,CADF;KAHA;AAMA,IAAA,IAAA,CAAA,CAAQ,IAAC,CAAA,MAAD,IAAY,IAAC,CAAA,MAAD,KAAW,OAAO,CAAC,IAAhC,CAAP;AACE,YAAU,IAAA,MAAM,CAAC,KAAP,CAAa,yCAAb,CAAV,CADF;KAAA,MAAA;AAOE,MAAA,GAAA,GAAU,IAAA,IAAA,CAAA,CAAV,CAAA;AAAA,MACA,KAAA,GAAQ,GAAA,GAAM,OAAO,CAAC,SADtB,CAAA;AAGA,MAAA,IAAG,KAAA,GAAQ,KAAX;AACE,cAAU,IAAA,MAAM,CAAC,KAAP,CAAa,wCAAb,CAAV,CADF;OAAA,MAAA;eAGE,IAAI,CAAC,QAAQ,CAAC,MAAd,CAAqB,SAArB,EAHF;OAVF;KAPa;EAAA,CAAf;CAFF,CAAA,CAAA","sourcesContent":["\n\nMeteor.methods\n\n  recallMessage: (messageId) ->\n    check(messageId, String)\n\n    message = Chat.Messages.findOne(messageId)\n    unless message\n      throw new Meteor.error(\"message doesn't exist\")\n\n    unless (@userId and @userId is message.from)\n      throw new Meteor.error(\"user has no right to delete the message\")\n\n    # In Healthcare settings, doctors or patients,\n    # should be responsible for the contents they send.\n    # They should not be able to recall history messages\n    else\n      now = new Date()\n      lapse = now - message.createdAt         # TODO: h.getTimeDifferentByMinutes()\n\n      if lapse > 60000\n        throw new Meteor.error(\"can't recall a message after 5 minutes\")\n      else\n        Chat.Messages.remove(messageId)"]}}