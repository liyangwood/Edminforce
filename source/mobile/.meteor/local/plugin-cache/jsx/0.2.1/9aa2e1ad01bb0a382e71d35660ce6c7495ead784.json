{"metadata":{"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}},"usedHelpers":[]},"ignored":false,"code":"/**\n * Created on 9/14/15.\n */\n\nDependency.add('ClassRegister.ViewControl.store', new function () {\n\n    var self = this;\n\n    //定义一个数据源 leftNav打开关闭\n    /*\n        0  下个session的注册尚未开始 本session已关闭\n        1  第一阶段\n        2  第2阶段\n        3  第3阶段\n        4  第4阶段\n        5  已经过了第4个阶段 但仍开放注册？\n         目前不是server side render 真正处于那个阶段 后端仍需check\n     * */\n    self.registerStage = new ReactiveVar(1);\n\n    self.appInfo = new ReactiveVar(1);\n\n    self.getCurrentClassCount = function () {\n        var appInfo = self.appInfo.get();\n\n        //if(!App.info) return;\n        return DB.ClassesRegister.find({\n            accountId: Meteor.userId(),\n            sessionId: appInfo && appInfo.sessionNow\n        });\n    };\n\n    self.getHistoryClassCount = function () {\n        //if(!App.info) return;\n        var appInfo = self.appInfo.get();\n\n        return DB.ClassesRegister.find({\n            accountId: Meteor.userId(),\n            sessionId: { $nin: [appInfo && appInfo.sessionNow, appInfo && appInfo.sessionRegister] }\n        });\n    };\n\n    //当前时间\n    function getStage() {}\n    //meteor  call\n\n    //acount 是否有swimmer正在参与课程\n\n    self.tokenId = Dispatcher.register(function (payload) {\n        switch (payload.actionType) {\n\n            case \"CRRegistraionInfoPage_CONTINUE\":\n                {\n\n                    var registerStage = self.registerStage.get();\n                    var isActive = self.getCurrentClassCount().count();\n                    var hasHistory = self.getHistoryClassCount().count();\n\n                    debugger;\n                    //var registerHref=\"/classRegister/register\"\n\n                    var commonRegisterPage = \"/classRegister/SelectClass\";\n                    var BookTheSameTimePage = \"/classRegister/BookTheSameTimePage\";\n\n                    if (registerStage == 1) {\n                        //\n\n                        if (isActive) {\n\n                            FlowRouter.go(BookTheSameTimePage);\n                        } else {\n                            if (hasHistory) {\n\n                                alert('第三阶段再来');\n                            } else {\n\n                                alert('第四阶段再来');\n                            }\n                        }\n                    } else if (registerStage == 2) {\n                        //current可自由选择\n\n                        if (isActive) {\n\n                            FlowRouter.go(commonRegisterPage);\n                        } else {\n                            if (hasHistory) {\n\n                                alert('第三阶段再来');\n                            } else {\n\n                                alert('第四阶段再来');\n                            }\n                        }\n                    } else if (registerStage == 3) {\n                        //return user可选择\n                        if (isActive) {\n\n                            FlowRouter.go(commonRegisterPage);\n                        } else {\n                            if (hasHistory) {\n\n                                FlowRouter.go(commonRegisterPage);\n                                // alert('第三阶段再来')\n                            } else {\n\n                                    alert('第四阶段再来');\n                                }\n                        }\n                    } else if (registerStage == 4) {\n                        //所有用户可选择\n\n                        FlowRouter.go(commonRegisterPage);\n                    }\n\n                    break;\n                }\n\n        }\n    });\n\n    Meteor.startup(function () {\n        Meteor.subscribe('registerInfoByAccountId', Meteor.userId());\n\n        Tracker.autorun(function () {\n            //if(!DB.Swimmers) return;\n\n            var appInfo = DB.App.findOne();\n\n            if (appInfo) {\n                self.appInfo.set(appInfo);\n                self.registerStage.set(appInfo.registerStage);\n            }\n        });\n    });\n}());","ast":null,"map":{"version":3,"sources":["/client/app/class.register/classRegisterViewControl.store.jsx"],"names":[],"mappings":"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","file":"/client/app/class.register/classRegisterViewControl.store.jsx.map","sourcesContent":["/**\n * Created on 9/14/15.\n */\n\nDependency.add('ClassRegister.ViewControl.store',new function(){\n\n    var self = this;\n\n    //定义一个数据源 leftNav打开关闭\n    /*\n        0  下个session的注册尚未开始 本session已关闭\n        1  第一阶段\n        2  第2阶段\n        3  第3阶段\n        4  第4阶段\n        5  已经过了第4个阶段 但仍开放注册？\n\n        目前不是server side render 真正处于那个阶段 后端仍需check\n\n    * */\n    self.registerStage = new ReactiveVar(1)\n\n    self.appInfo = new ReactiveVar(1)\n\n\n\n    self.getCurrentClassCount= function(){\n        var appInfo= self.appInfo.get()\n\n        //if(!App.info) return;\n        return DB.ClassesRegister.find({\n            accountId:Meteor.userId(),\n            sessionId:appInfo && appInfo.sessionNow\n        })\n\n    }\n\n\n\n\n    self.getHistoryClassCount= function(){\n        //if(!App.info) return;\n        var appInfo= self.appInfo.get()\n\n        return DB.ClassesRegister.find({\n            accountId:Meteor.userId(),\n            sessionId:{$nin:[appInfo && appInfo.sessionNow , appInfo && appInfo.sessionRegister]}\n        })\n\n    }\n\n\n     //当前时间\n    function getStage(){\n        //meteor  call\n\n    }\n\n    //acount 是否有swimmer正在参与课程\n\n\n    self.tokenId = Dispatcher.register(function(payload){\n        switch(payload.actionType){\n\n\n            case \"CRRegistraionInfoPage_CONTINUE\":{\n\n                var registerStage = self.registerStage.get()\n                var isActive = self.getCurrentClassCount().count()\n                var hasHistory = self.getHistoryClassCount().count()\n\n\n                debugger\n                //var registerHref=\"/classRegister/register\"\n\n                var commonRegisterPage = \"/classRegister/SelectClass\"\n                var BookTheSameTimePage =\"/classRegister/BookTheSameTimePage\"\n\n                if(registerStage ==1){//\n\n                    if(isActive){\n\n                        FlowRouter.go(BookTheSameTimePage);\n\n                    }else{\n                        if(hasHistory){\n\n                            alert('第三阶段再来')\n\n                        }else{\n\n                            alert('第四阶段再来')\n                        }\n                    }\n\n                }else if(registerStage ==2){//current可自由选择\n\n                    if(isActive){\n\n                        FlowRouter.go(commonRegisterPage);\n\n                    }else{\n                        if(hasHistory){\n\n                            alert('第三阶段再来')\n\n                        }else{\n\n                            alert('第四阶段再来')\n                        }\n                    }\n\n                }else if(registerStage ==3){//return user可选择\n                    if(isActive){\n\n                        FlowRouter.go(commonRegisterPage);\n\n                    }else{\n                        if(hasHistory){\n\n                            FlowRouter.go(commonRegisterPage);\n                           // alert('第三阶段再来')\n\n                        }else{\n\n                            alert('第四阶段再来')\n\n                        }\n                    }\n\n\n                }else if(registerStage ==4){//所有用户可选择\n\n                    FlowRouter.go(commonRegisterPage);\n\n                }\n\n                break;\n            }\n\n        }\n    });\n\n\n\n    Meteor.startup(function () {\n        Meteor.subscribe('registerInfoByAccountId',Meteor.userId())\n\n\n        Tracker.autorun(function () {\n            //if(!DB.Swimmers) return;\n\n            var appInfo = DB.App.findOne()\n\n            if(appInfo){\n                self.appInfo.set(appInfo)\n                self.registerStage.set(appInfo.registerStage)\n            }\n\n        })\n    })\n\n\n});"]},"hash":"9aa2e1ad01bb0a382e71d35660ce6c7495ead784"}
