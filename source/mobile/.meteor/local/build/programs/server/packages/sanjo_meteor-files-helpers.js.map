{"version":3,"sources":["meteor://ðŸ’»app/packages/sanjo_meteor-files-helpers/lib/meteor/files.js","meteor://ðŸ’»app/packages/sanjo_meteor-files-helpers/meteor_files_helpers.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2H;;;;;;;;;;;;;;;;;;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4H","file":"/packages/sanjo_meteor-files-helpers.js","sourcesContent":["/**\n * Copied from Meteor tools/files.js.\n *\n * Includes:\n * - Helper to find the app root path\n */\n\nvar path = Npm.require('path');\nvar fs = Npm.require('fs');\n\n// given a predicate function and a starting path, traverse upwards\n// from the path until we find a path that satisfies the predicate.\n//\n// returns either the path to the lowest level directory that passed\n// the test or null for none found. if starting path isn't given, use\n// cwd.\nfindUpwards = function (predicate, startPath) {\n  var testDir = startPath || process.cwd();\n  while (testDir) {\n    if (predicate(testDir)) {\n      break;\n    }\n    var newDir = path.dirname(testDir);\n    if (newDir === testDir) {\n      testDir = null;\n    } else {\n      testDir = newDir;\n    }\n  }\n  if (!testDir)\n    return null;\n\n  return testDir;\n};\n\n// Determine if 'filepath' (a path, or omit for cwd) is within an app\n// directory. If so, return the top-level app directory.\nfindAppDir = function (filepath) {\n  var isAppDir = function (filepath) {\n    // XXX once we are done with the transition to engine, this should\n    // change to: `return fs.existsSync(path.join(filepath, '.meteor',\n    // 'release'))`\n\n    // .meteor/packages can be a directory, if .meteor is a warehouse\n    // directory.  since installing meteor initializes a warehouse at\n    // $HOME/.meteor, we want to make sure your home directory (and all\n    // subdirectories therein) don't count as being within a meteor app.\n    try { // use try/catch to avoid the additional syscall to fs.existsSync\n      return fs.statSync(path.join(filepath, '.meteor', 'packages')).isFile();\n    } catch (e) {\n      return false;\n    }\n  };\n\n  return findUpwards(isAppDir, filepath);\n};\n","var path = Npm.require('path')\nvar fs = Npm.require('fs')\nvar readFile = Meteor.wrapAsync(fs.readFile, fs)\nvar exists = Meteor.wrapAsync(function (path, callback) {\n  fs.exists(path, function (result) {\n    callback(null, result)\n  })\n})\n\nMeteorFilesHelpers = {\n  getAppPath: function () {\n    var appPath = findAppDir();\n    return appPath ? path.resolve(appPath) : null;\n  },\n\n  getMeteorToolPath: function () {\n    return this._findMeteorToolDir(process.execPath);\n  },\n\n  _findMeteorToolDir: function (filepath) {\n    return findUpwards(this._isMeteorToolDir.bind(this), filepath);\n  },\n\n  _isMeteorToolDir: function (filepath) {\n    try { // use try/catch to avoid the additional syscall to fs.existsSync\n      return fs.statSync(path.join(filepath, 'meteor')).isFile();\n    } catch (e) {\n      return false;\n    }\n  },\n\n  getMeteorInstallationPath: function () {\n    var meteorPath\n    if (isWindows()) {\n      meteorPath = process.env.METEOR_INSTALLATION\n      if (meteorPath[meteorPath.length - 1] === '\\\\') {\n        meteorPath = meteorPath.substr(0, meteorPath.length - 1)\n      }\n\n    } else {\n      meteorPath = path.resolve(MeteorFilesHelpers.getMeteorToolPath(), '../../../..')\n    }\n\n    return meteorPath\n  },\n\n  getNodeModulePath: function (meteorPackageName, nodeModuleName) {\n    var localIsopackPath = path.join(\n      MeteorFilesHelpers.getAppPath(),\n      '.meteor', 'local', 'isopacks',\n      getFilesystemMeteorPackageName(meteorPackageName)\n    )\n    if (exists(localIsopackPath)) {\n      return path.join(localIsopackPath, 'npm', 'node_modules', nodeModuleName)\n    } else {\n      if (isWindows()) {\n        return path.join(\n          MeteorFilesHelpers.getMeteorInstallationPath(),\n          'packages',\n          getFilesystemMeteorPackageName(meteorPackageName), MeteorFilesHelpers.getPackageVersion(meteorPackageName),\n          'npm', 'node_modules', nodeModuleName\n        )\n      } else {\n        return path.join(\n          MeteorFilesHelpers.getAppPath(),\n          '.meteor', 'local', 'build', 'programs', 'server',\n          'npm', getFilesystemMeteorPackageName(meteorPackageName),\n          'node_modules', nodeModuleName\n        )\n      }\n    }\n  },\n\n  getPackageServerAssetPath: function (meteorPackageName, assetPath) {\n    return path.join(\n      MeteorFilesHelpers.getAppPath(),\n      '.meteor', 'local', 'build', 'programs', 'server', 'assets', 'packages',\n      getFilesystemMeteorPackageName(meteorPackageName),\n      assetPath\n    )\n  },\n\n  getPackageVersions: _.memoize(function () {\n    var versionsFilePath = path.join(\n      MeteorFilesHelpers.getAppPath(), '.meteor', 'versions'\n    )\n    var versionsContent = readFile(versionsFilePath, {encoding: 'utf8'})\n    var versionsHash = {}\n    versionsContent.split(/\\r\\n|\\r|\\n/).forEach(function (packageConstraint) {\n      var parts = packageConstraint.split('@')\n      var packageName = parts[0]\n      var packageVersion = parts[1]\n      versionsHash[packageName] = packageVersion\n    })\n\n    return versionsHash\n  }),\n\n  getPackageVersion: function (packageName) {\n    var packageVersions = MeteorFilesHelpers.getPackageVersions()\n\n    return packageVersions[packageName]\n  },\n\n  isPackageInstalled: function (meteorPackageName, meteorPackageVersion) {\n    var packagePath = path.join(\n      MeteorFilesHelpers.getMeteorInstallationPath(),\n      'packages',\n      getFilesystemMeteorPackageName(meteorPackageName)\n    )\n\n    if (meteorPackageVersion) {\n      packagePath = path.join(packagePath, meteorPackageVersion)\n    }\n\n    return exists(packagePath)\n  }\n}\n\nfunction isWindows() {\n  return process.platform === 'win32'\n}\n\nfunction getFilesystemMeteorPackageName(meteorPackageName) {\n  var meteorVersion = MeteorVersion.getSemanticVersion()\n  return (meteorVersion && PackageVersion.lessThan(meteorVersion, '1.0.4')) ?\n    meteorPackageName :\n    meteorPackageName.replace(':', '_')\n}\n"]}