{"version":3,"sources":["meteor://ðŸ’»app/server/methods/common.js"],"names":[],"mappings":"eAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E","file":"/server/methods/common.js","sourcesContent":["/**\n * Created on 9/30/15.\n */\n\nMeteor.startup(function () {\n\n    Meteor.methods({\n\n            //this is an anti partern\n            //å¯¼è‡´ RangeError: Maximum call stack size exceeded todo check\n            getAccountSwimmersClasses: function () {\n\n                var accountId= this.userId\n\n                if(!accountId) return{}\n\n\n                //console.log(accountId)\n                return accountId;\n\n\n                var swimmers = DB.Swimmers.find({\n                    accountId:accountId\n                })\n\n\n                var swimmerIds = swimmers.map(function(v){\n                    return v._id\n                })\n\n\n                var classesRegister= DB.ClassesRegister.find({\n                        swimmerId:{$in:swimmerIds}\n                    }\n                )\n\n\n                var classIds= classesRegister.map(function(v){\n                    return v.classId\n                })\n                classIds= _.uniq(classIds)\n\n                var classes =DB.Classes.find({\n                    _id:{$in:classIds}\n                })\n\n                var classesMap = {}\n                classes.forEach(function(v){\n                    classesMap[v._id]=v\n                })\n\n\n\n                var swimmerClasses={}\n\n                classesRegister.forEach(function(v){\n                    if(!swimmerClasses[v.swimmerId]){\n                        swimmerClasses[v.swimmerId]=[]\n                    }\n\n                    swimmerClasses[v.swimmerId].push(v)\n\n                })\n\n\n\n\n                return{\n                    swimmers:swimmers,\n                    classes:classes,\n                    classesMap:classesMap,\n                    swimmerClasses:swimmerClasses\n                }\n\n\n            }\n        }\n    )\n\n\n})"]}