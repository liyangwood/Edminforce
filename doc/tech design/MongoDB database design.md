## Overview
This document describes the details of each collection. Basically, we need following collections:

* users: mainly for login information, Meteor user and account framework will create this collection by default.
* role: to record different roles we have, Meteor Role package will create the form automatically
* swimmers: normal swimmer information, embed class information. Easy for querying, ranking and other swimmer related DB operations 
* classes: swim class information, refers to swimmers collection, refers to coach information. Easy for DB CRUD operations from admin side.

## "users" collection
Those accounts who needs login to the system with password should create user login information in this collection.
So far normal account users, coaches and admins need to create user login information in this collection.

NOTE: No separated "coaches" collection since it can be covered in this "users" collection

### "user" document

#### "account" document
```javascript
{
  _id: "bbca5d6a-2156-41c4-89da-0329e8c99a4f",  // Meteor.userId()
  emails: [
    // each email address can only belong to one user.
    // email is also used as login credential
    { address: "cool@example.com", verified: true },
  ],
  createdAt: Wed Aug 21 2013 15:16:52 GMT-0700 (PDT),
  profile: {
        // The profile is writable by the user by default.
        name: "Joe Schmoe",
        phone: "+1 555 555 5555",
        address: "Somewhere, San Jose, CA 95134",
        location: "Dublin" or "Fremont",
    },

  role: 'account',

  credits: 200.00, // Credit that can be used to buy class
  paymentInfo: { // Payment information for online payment. TODO}

  alterContact: { // Alternative contact information
        name: "Mike Zhang"
        email: "mikezhang@gmail.com",
        phone: "+1 666 666 6666",
        address: "Somewhere, San Jose, CA 95134",
        relation: "Friend",
        allowContact: true,
  },
  emergencyContact: { // Emergency contact information
        name: "Cindy Wu"
        email: "cindywu@gmail.com",
        phone: "+1 888 888 8888",
        address: "Somewhere, San Jose, CA 95134",
        relation: "Sister",
  },

  swimmers: [ // Swimmers array contains all the information about swimmers
      {
             // please refers to "swimmer" document
      },
  ],
}
```

#### "coach" document
```javascript
{
  _id: "bbca5d6a-2156-41c4-89da-0329e8c5656a",  // Meteor.userId()
  emails: [
    // each email address can only belong to one user.
    // email is also used as login credential
    { address: "cool@example.com", verified: true },
  ],
  createdAt: Wed Aug 21 2013 15:16:52 GMT-0700 (PDT),
  profile: {
      // The profile is writable by the user by default.
      name: "Joe Schmoe",
      phone: "+1 555 555 5555",
      address: "Somewhere, San Jose, CA 95134",
      location: "Dublin" or "Fremont",
  },
  role: 'coach',
  classes: [ // classes array contains ID of the class not embedded class document here.
      {
            _id: "bbca5d6a-2156-41c4-89da-0329e8c5656a",
      },
      ...,
  ],
}
```

#### "admin" document
This document should be similar with normal [Meteor user document](http://docs.meteor.com/#/full/meteor_users) but with admin role.

Every account/coach/admin will create a document in "users" collection when they sign up. The rest part of our App will use Meteor.userId() to refer to this login information.

## "role" collection
Every user has at least one role. Now we have the following roles: account, coach, admin. We push different message to different roles.

This collection is to record all the roles we have. It is automatically generated by 'role' package

For APIs, please check [Role Package](https://atmospherejs.com/alanning/roles)

## "swimmers" collection
This collection holds all the information of swimmers.

### "swimmer" document
```javascript
{
    _id: "bbca5d6a-2156-41c4-89da-0329e2deb9a4", // created when insert a new swimmer into "swimmers" collection
    name: "Jessica Wang",
    accountId: "bbca5d6a-2156-41c4-89da-0329e8c99a4f", // match account's user ID
    birthday: Wed Aug 21 2013 15:16:52 GMT-0700 (PDT), 
    gender: "Female",
    age: 2,
    allergy: "Peanuts, ...",
    level: 1,
    waiveFormAgreed: true,
    paymentStatus: true,
    location: "Dublin" or "Fremont",
    meetingDate: Wed Aug 21 2015 13:00:00 GMT-0700 (PDT), // meeting with coach
    registerAt: Wed Aug 21 2013 15:16:52 GMT-0700 (PDT), 
    paymentStartTime: Wed Aug 21 2013 15:16:52 GMT-0700 (PDT), // to start 15 minutes payment period
    classes: [ //an array of class IDS, one swimmer can attend multiple classes
        {
            _id: "bbca5d6a-2156-41c4-89da-0329e2deb9a4",
        },
    ],
    future-classes: [
        {
            _id: "bbca5d6a-2156-41c4-89da-0329e2deb9a4",
        },
    ],
}
```

## "classes" collection
This collection is easily managed by admins and easy to generate classes calendar for class registration.

### "class" document
```javascript
{
    _id: "bbca5d6a-2156-41c4-89da-0329e2deb9a4", // created when insert a new "class" document into "classes" collection
    name: "Level 1 freestyle swim class",
    startDate: Wed Aug 21 2015 13:00:00 GMT-0700 (PDT),
    endDate: Wed Oct 21 2015 13:00:00 GMT-0700 (PDT),
    duration: "2 hours",
    frequency: "Every Monday",
    level: 1,
    type: "Freestyle",
    coachId: "bbca5d6a-2156-41c4-89da-0329e888efc5", // match coach's user ID
    coachName: "Steve Guo",
    availableSeats: 8,

    students: [ // students array to store "swimmer" ID
        {
             _id: "bbca5d6a-2156-41c4-89da-0329e2deb9a4",
        },
    ],
}
```

* Question:
 How to handle the class date in a good way? Any calendar package?

* Question:
At payment, first we create a page of summary, then the user agrees to make the payment. When he clicks check-out, we
set the paymentStartTime in swimmers,  and decrease the number of  available seats by one. Then we start a timer on the
server. If the payment is successful, we move the student to student enrolled. Otherwise, if we receive a time-out
exeption, we will increase the number of available seats by one.

If we can do this, how can we make sure that the payment procedure is interrupted? Can we intervene the execution of
 stripe?